# üóÑÔ∏è SUPABASE - Configura√ß√£o e Estrutura do Banco de Dados

## üìä Informa√ß√µes do Projeto Supabase

**Projeto ID:** `adxwgpfkvizpqdvortpu`  
**Nome do Projeto:** "AGENDA PRO"  
**Organiza√ß√£o:** "AGENDA PRO" (ID: yxktlevmspnimkxwnbsl)
**URL da API:** `https://adxwgpfkvizpqdvortpu.supabase.co`  
**Regi√£o:** sa-east-1 (S√£o Paulo)  
**Status:** ‚úÖ ACTIVE_HEALTHY  
**Plano:** Pro (com AI SQL Generator, AI Log Generator e AI Data Generator habilitados)  
**Vers√£o PostgreSQL:** 15.8.1.093 (on aarch64-unknown-linux-gnu)  
**Criado em:** 26/05/2025 18:59:59 UTC  
**√öltima Atualiza√ß√£o via MCP:** 22/07/2025 10:32:15 UTC  

## üîê Credenciais e Configura√ß√£o

### Vari√°veis de Ambiente (.env)
```env
VITE_SUPABASE_URL=https://adxwgpfkvizpqdvortpu.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeHdncGZrdml6cHFkdm9ydHB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyODU5OTksImV4cCI6MjA2Mzg2MTk5OX0.L79cLQdkA8_PLE2QQ4nGM1i8M0rESZWK7HlfrugIk0o
```

### Configura√ß√£o no C√≥digo
```typescript
// src/integrations/supabase/client.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'https://adxwgpfkvizpqdvortpu.supabase.co'
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

## üóÇÔ∏è Estrutura Completa do Banco de Dados

### üìã Resumo das Tabelas (36 tabelas ativas)

| Tabela | Registros Vivos | Tamanho | RLS | Fun√ß√£o Principal |
|--------|-----------------|---------|-----|------------------|
| **sistema_backups** | 1022 | 3048 kB | ‚úÖ | Sistema de backups autom√°ticos |
| **financeiro_categorias** | 25 | 88 kB | ‚úÖ | Categorias financeiras |
| **financeiro_formas_pagamento** | 21 | 72 kB | ‚úÖ | Formas de pagamento |
| **agenda_eventos** | 18 | 160 kB | ‚úÖ | Sistema de agenda |
| **clientes** | 18 | 112 kB | ‚úÖ | Gest√£o de clientes |
| **entregar_imagens** | 9 | 504 kB | ‚úÖ | Entrega de fotos/galerias |
| **contratos** | 7 | 280 kB | ‚úÖ | Gest√£o de contratos |
| **tipos_evento** | 7 | 48 kB | ‚úÖ | Tipos de eventos |
| **portfolio_trabalhos** | 5 | 1640 kB | ‚úÖ | Portf√≥lio de trabalhos |
| **sistema_atividades** | 3 | 32 kB | ‚úÖ | Log de atividades |
| **financeiro_despesas** | 2 | 160 kB | ‚úÖ | Controle de despesas |
| **solicitacoes_orcamento** | 1 | 112 kB | ‚úÖ | Solicita√ß√µes de or√ßamento |
| **mensagens_modelos** | 1 | 96 kB | ‚úÖ | Templates de mensagens |
| **configuracoes_empresa** | 1 | 64 kB | ‚úÖ | Configura√ß√µes da empresa |
| **indicacoes** | 1 | 64 kB | ‚úÖ | Sistema de indica√ß√µes |
| **perfis** | 0 | 64 kB | ‚úÖ | Perfis de usu√°rios |
| **relatorios** | 0 | 112 kB | ‚úÖ | Relat√≥rios financeiros |
| **financeiro_transacoes** | 0 | 88 kB | ‚úÖ | Transa√ß√µes financeiras |
| **anexos_contrato** | 0 | 48 kB | ‚úÖ | Anexos de contratos |
| **atividades** | 0 | 48 kB | ‚úÖ | Atividades do sistema |
| **integracoes_calendario** | 0 | 40 kB | ‚úÖ | Integra√ß√µes Google Calendar |
| **usuarios** | 0 | 32 kB | ‚úÖ | Usu√°rios do sistema |
| **financeiro_transacoes_historico** | 0 | 32 kB | ‚úÖ | Hist√≥rico de transa√ß√µes |
| **mensagens_configuracoes** | 0 | 32 kB | ‚úÖ | Config. de mensagens |
| **configuracoes_integracoes** | 0 | 24 kB | ‚úÖ | Integra√ß√µes e webhooks |
| **respostas_orcamento** | 0 | 24 kB | ‚úÖ | Respostas de or√ßamento |
| **mensagens_gatilhos** | 0 | 16 kB | ‚úÖ | Gatilhos de automa√ß√£o |
| **user_roles** | 0 | 16 kB | ‚úÖ | Roles de usu√°rios |
| **notificacoes** | 0 | 16 kB | ‚úÖ | Sistema de notifica√ß√µes |
| **mensagens_programadas** | 0 | 16 kB | ‚úÖ | Mensagens programadas |
| **mensagens_logs** | 0 | 16 kB | ‚úÖ | Logs de mensagens |
| **mensagens** | 0 | 16 kB | ‚úÖ | Mensagens b√°sicas |
| **agendamentos** | 0 | 16 kB | ‚úÖ | Sistema de agendamentos |
| **pagamentos** | 0 | 16 kB | ‚úÖ | Sistema de pagamentos |
| **modelos_contrato** | 0 | 16 kB | ‚úÖ | Modelos de contrato |
| **dashboard_cliente** | 0 | 16 kB | ‚úÖ | Dashboard de clientes |

**Total:** 36 tabelas | 1.141 registros vivos | 132 registros mortos | ~7.2 MB (tabelas p√∫blicas) | 20 MB (banco total)

## üìä Detalhamento das Tabelas Principais

### 1. **perfis** - Perfis de Usu√°rios
```sql
CREATE TABLE perfis (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  nome TEXT NOT NULL,
  email TEXT NOT NULL,
  role TEXT DEFAULT 'usuario',
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  avatar_url TEXT
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem seus pr√≥prios perfis" 
ON perfis FOR ALL USING (auth.uid() = id);
```

**üìã Dados Atuais (0 registros ativos):**
- **Status:** Tabela vazia (dados migrados para auth.users)
- **RLS:** ‚úÖ Habilitado
- **Tamanho:** 64 kB

### 2. **clientes** - Gest√£o de Clientes  
```sql
CREATE TABLE clientes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  nome TEXT NOT NULL,
  telefone TEXT,
  evento TEXT,
  data_evento TIMESTAMPTZ,
  valor_evento NUMERIC,
  data_nascimento DATE,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  criado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem seus pr√≥prios clientes" 
ON clientes FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (18 registros ativos):**

**üîù Top 10 Clientes Mais Recentes:**
1. **"2 Talytta Schulze Neves"**
   - Telefone: 64992471909
   - Evento: Casamento | Data: 03/07/2025
   - Valor: R$ 2.500,00

2. **"Casamento Kelly"**
   - Telefone: 04545545511
   - Evento: Casamento | Data: 14/07/2025
   - Valor: R$ 2.000,00

3. **"Casamento Kelly"**
   - Telefone: 04545545511
   - Evento: Casamento | Data: 11/07/2025
   - Valor: R$ 2.000,00

4. **"Evento - Casamento Kelly"**
   - Telefone: 04545545511
   - Evento: (vazio) | Data: 11/07/2025
   - Valor: R$ 2.000,00

5. **"DIOGO GON√áALVES DA MOTA"**
   - Telefone: 64993296649
   - Evento: Anivers√°rio | Data: 24/07/2025
   - Valor: R$ 0,00

6. **"DIOGO GON√áALVES DA MOTA"**
   - Telefone: 64992750733
   - Evento: Corporativo | Data: 25/07/2025
   - Valor: R$ 0,00

7. **"Agenda Pro 2"**
   - Telefone: 64966562232
   - Evento: Outro | Data: 26/07/2025
   - Valor: R$ 2.000,00

8. **"Agenda Pro"**
   - Telefone: 64985630055
   - Evento: Casamento | Data: 29/06/2025
   - Valor: R$ 5.000,00

9. **"Agenda Pro"**
   - Telefone: 64985630000
   - Evento: Casamento | Data: 29/06/2025
   - Valor: R$ 5.000,00

10. **"Agenda Pro"**
    - Telefone: 64985632344
    - Evento: Casamento | Data: 29/06/2025
    - Valor: R$ 5.000,00

**üí∞ Total de Valor em Eventos:** R$ 22.500,00

**üìä Estat√≠sticas:** Live: 18 | Dead: 1

### 3. **agenda_eventos** - Sistema de Agenda
```sql
CREATE TABLE agenda_eventos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  cliente_id UUID REFERENCES clientes(id),
  titulo TEXT NOT NULL,
  descricao TEXT,
  data_inicio TIMESTAMPTZ NOT NULL,
  data_fim TIMESTAMPTZ NOT NULL,
  local TEXT,
  tipo TEXT,
  cor TEXT,
  status TEXT DEFAULT 'agendado' CHECK (status IN ('agendado', 'confirmado', 'cancelado', 'concluido')),
  telefone TEXT,
  notificacao_enviada BOOLEAN DEFAULT FALSE,
  observacoes TEXT,
  valor_total NUMERIC,
  valor_entrada NUMERIC,
  valor_restante NUMERIC,
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem seus pr√≥prios eventos" 
ON agenda_eventos FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (18 eventos ativos):**

**üîù Top 10 Eventos Mais Recentes:**
1. **"Batizado - 21/7"**
   - Local: Parque da Cidade
   - Data: 21/07/2025 18:32:00 - 22:32:00 UTC
   - Status: concluido

2. **"Ensaio - 19/7"**
   - Local: Igreja S√£o Jos√©
   - Data: 19/07/2025 18:32:00 - 22:32:00 UTC
   - Status: confirmado

3. **"Casamento - 18/7"**
   - Local: Buffet Tulipas
   - Data: 18/07/2025 18:32:00 - 22:32:00 UTC
   - Status: concluido

4. **"Anivers√°rio - 20/7"**
   - Local: Est√∫dio Central
   - Data: 20/07/2025 18:32:00 - 22:32:00 UTC
   - Status: agendado

5. **"Ensaio - 14/7"**
   - Local: Igreja S√£o Jos√©
   - Data: 14/07/2025 18:32:00 - 22:32:00 UTC
   - Status: agendado

6. **"Batizado - 16/7"**
   - Local: Parque da Cidade
   - Data: 16/07/2025 18:32:00 - 22:32:00 UTC
   - Status: confirmado

7. **"Casamento - 13/7"**
   - Local: Buffet Tulipas
   - Data: 13/07/2025 18:32:00 - 22:32:00 UTC
   - Status: confirmado

8. **"Formatura - 17/7"**
   - Local: Sal√£o de Festas
   - Data: 17/07/2025 18:32:00 - 22:32:00 UTC
   - Status: agendado

9. **"Anivers√°rio - 15/7"**
   - Local: Est√∫dio Central
   - Data: 15/07/2025 18:32:00 - 22:32:00 UTC
   - Status: concluido

10. **"Formatura - 22/7"**
    - Local: Sal√£o de Festas
    - Data: 22/07/2025 18:32:00 - 22:32:00 UTC
    - Status: confirmado

**üìä Estat√≠sticas:** Live: 18 | Dead: 10

### 4. **configuracoes_empresa** - Configura√ß√µes da Empresa
```sql
CREATE TABLE configuracoes_empresa (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) UNIQUE,
  nome_empresa TEXT,
  cnpj TEXT,
  telefone TEXT,
  whatsapp TEXT,
  email_empresa TEXT,
  endereco TEXT,
  cidade TEXT,
  estado TEXT,
  cep TEXT,
  instagram TEXT,
  facebook TEXT,
  site TEXT,
  logo_url TEXT,
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias configura√ß√µes" 
ON configuracoes_empresa FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (1 configura√ß√£o ativa):**

**üîù Configura√ß√£o Mais Recente:**
- **Nome da Empresa:** "Diogo Gon√ßalves da Mota"
- **Telefone:** "64993296649"
- **WhatsApp:** null
- **Email:** "agendaparafotografo@gmail.com"
- **Cidade:** "R√≠o Verde"
- **Estado:** "GO"
- **Instagram:** null
- **Site:** null
- **Criado em:** 03/07/2025 22:14:22 UTC
- **Atualizado em:** 14/07/2025 04:13:13 UTC

**üìä Estat√≠sticas:** Live: 1 | Dead: 5

### 5. **portfolio_trabalhos** - Portf√≥lio de Trabalhos
```sql
CREATE TABLE portfolio_trabalhos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  titulo TEXT NOT NULL,
  descricao TEXT,
  categoria TEXT,
  tags TEXT[],
  data_evento DATE,
  cliente_id UUID REFERENCES clientes(id),
  publicado BOOLEAN DEFAULT TRUE,
  destaque BOOLEAN DEFAULT FALSE,
  imagem_capa TEXT,
  imagens TEXT[],
  local TEXT,
  url_imagem_drive TEXT,
  urls_drive TEXT[] DEFAULT '{}',
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem seus pr√≥prios trabalhos" 
ON portfolio_trabalhos FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (5 trabalhos ativos):**

**üé® Portf√≥lio de Trabalhos Recentes:**
1. **"Nath√°lia e Bruno - Gesta√ß√£o da Mariana"**
   - Categoria: Gestante
   - Status: ‚úÖ Publicado
   - Destaque: N√£o
   - Criado em: 12/07/2025

2. **"Casamento do Maria"**
   - Categoria: Gestante
   - Local: Rua Dona Mota
   - Status: ‚úÖ Publicado
   - Destaque: N√£o
   - Criado em: 11/07/2025

3. **"Cas Diogo"**
   - Categoria: Casamento
   - Local: Rio verde
   - Status: ‚úÖ Publicado
   - Destaque: N√£o
   - Criado em: 09/07/2025

4. **"Confirma√ß√£o de Agendamento"**
   - Categoria: Anivers√°rio
   - Local: Rio verde
   - Status: ‚úÖ Publicado
   - Destaque: N√£o
   - Criado em: 09/07/2025

5. **"Corrida RUA"**
   - Categoria: Outro
   - Status: ‚úÖ Publicado
   - Destaque: N√£o
   - Criado em: 08/07/2025

**üìä Estat√≠sticas:** Live: 5 | Dead: 31

### 6. **financeiro_categorias** - Categorias Financeiras
```sql
CREATE TABLE financeiro_categorias (
  id UUID PRIMARY KEY,
  nome VARCHAR NOT NULL,
  tipo VARCHAR NOT NULL CHECK (tipo IN ('receita', 'despesa')),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias categorias" 
ON financeiro_categorias FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (34 categorias configuradas):**

**üìä Estat√≠sticas:** Live: 34 | Dead: 4

### 7. **financeiro_formas_pagamento** - Formas de Pagamento
```sql
CREATE TABLE financeiro_formas_pagamento (
  id UUID PRIMARY KEY,
  nome VARCHAR NOT NULL,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias formas de pagamento" 
ON financeiro_formas_pagamento FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (29 formas configuradas):**

**üìä Estat√≠sticas:** Live: 29 | Dead: 7

### 8. **financeiro_despesas** - Controle de Despesas
```sql
CREATE TABLE financeiro_despesas (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  cliente_id UUID REFERENCES clientes(id),
  descricao TEXT NOT NULL,
  valor NUMERIC NOT NULL,
  status TEXT DEFAULT 'pendente' CHECK (status IN ('pendente', 'pago', 'cancelado', 'vencido')),
  data_transacao TIMESTAMPTZ DEFAULT CURRENT_DATE,
  categoria TEXT,
  forma_pagamento TEXT,
  observacoes TEXT,
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias despesas" 
ON financeiro_despesas FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (5 despesas registradas):**

**üìä Estat√≠sticas:** Live: 5 | Dead: 2

### 9. **contratos** - Gest√£o de Contratos
```sql
CREATE TABLE contratos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  titulo TEXT NOT NULL,
  descricao TEXT,
  status TEXT DEFAULT 'pendente',
  cliente_id UUID REFERENCES clientes(id),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  valor NUMERIC,
  data_evento TIMESTAMPTZ,
  tipo_evento TEXT,
  conteudo TEXT,
  anexos JSONB,
  historico JSONB,
  assinatura_url TEXT,
  data_assinatura TIMESTAMPTZ,
  data_expiracao TIMESTAMPTZ,
  email_cliente TEXT
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem seus pr√≥prios contratos" 
ON contratos FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (7 contratos ativos):**

**üìä Estat√≠sticas:** Live: 7 | Dead: 23

### 10. **solicitacoes_orcamento** - Solicita√ß√µes de Or√ßamento
```sql
CREATE TABLE solicitacoes_orcamento (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  numero_referencia VARCHAR UNIQUE NOT NULL,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  nome_completo VARCHAR NOT NULL,
  email VARCHAR NOT NULL,
  telefone VARCHAR NOT NULL,
  tipo_evento VARCHAR NOT NULL,
  data_pretendida DATE,
  local_evento TEXT,
  numero_participantes INTEGER,
  duracao_estimada VARCHAR,
  detalhes_adicionais TEXT,
  status VARCHAR DEFAULT 'pendente',
  data_criacao TIMESTAMPTZ DEFAULT NOW(),
  data_atualizacao TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias solicita√ß√µes" 
ON solicitacoes_orcamento FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (1 solicita√ß√£o ativa):**

**üìä Estat√≠sticas:** Live: 1 | Dead: 0

### 11. **tipos_evento** - Tipos de Eventos
```sql
CREATE TABLE tipos_evento (
  id SERIAL PRIMARY KEY,
  nome VARCHAR UNIQUE NOT NULL,
  descricao TEXT,
  ativo BOOLEAN DEFAULT TRUE,
  ordem_exibicao INTEGER DEFAULT 0
);

-- Sem RLS - Tabela de refer√™ncia global
```

**üìã Dados Atuais (7 tipos configurados):**

**üéØ Tipos de Eventos Dispon√≠veis:**
1. **Casamento** (Ordem: 1)
   - Descri√ß√£o: Cerim√¥nia e festa de casamento
   - Status: ‚úÖ Ativo

2. **Anivers√°rio** (Ordem: 2)
   - Descri√ß√£o: Festa de anivers√°rio
   - Status: ‚úÖ Ativo

3. **Formatura** (Ordem: 3)
   - Descri√ß√£o: Cerim√¥nia de formatura
   - Status: ‚úÖ Ativo

4. **Evento Corporativo** (Ordem: 4)
   - Descri√ß√£o: Eventos empresariais
   - Status: ‚úÖ Ativo

5. **Book Fotogr√°fico** (Ordem: 5)
   - Descri√ß√£o: Sess√£o de fotos
   - Status: ‚úÖ Ativo

6. **Batizado/Comunh√£o** (Ordem: 6)
   - Descri√ß√£o: Eventos religiosos
   - Status: ‚úÖ Ativo

7. **Outros** (Ordem: 99)
   - Descri√ß√£o: Outros tipos de evento
   - Status: ‚úÖ Ativo

**üìä Estat√≠sticas:** Live: 7 | Dead: 0

### 12. **entregar_imagens** - Entrega de Fotos
```sql
CREATE TABLE entregar_imagens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  titulo TEXT NOT NULL,
  descricao TEXT,
  slug TEXT UNIQUE NOT NULL,
  data_entrega DATE DEFAULT CURRENT_DATE,
  data_expiracao TIMESTAMPTZ,
  senha_acesso TEXT,
  status TEXT DEFAULT 'ativa' CHECK (status IN ('ativa', 'expirada', 'arquivada', 'inativa')),
  total_fotos INTEGER DEFAULT 0 CHECK (total_fotos >= 0),
  total_acessos INTEGER DEFAULT 0 CHECK (total_acessos >= 0),
  total_downloads INTEGER DEFAULT 0 CHECK (total_downloads >= 0),
  ultimo_acesso TIMESTAMPTZ,
  permitir_download BOOLEAN DEFAULT TRUE,
  permitir_compartilhamento BOOLEAN DEFAULT TRUE,
  marca_dagua BOOLEAN DEFAULT FALSE,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  criado_em TIMESTAMPTZ DEFAULT NOW(),
  atualizado_em TIMESTAMPTZ DEFAULT NOW(),
  nome_arquivo TEXT NOT NULL,
  nome_original TEXT,
  url_imagem TEXT NOT NULL,
  url_thumbnail TEXT,
  url_preview TEXT,
  tamanho_arquivo BIGINT CHECK (tamanho_arquivo IS NULL OR tamanho_arquivo > 0),
  largura INTEGER,
  altura INTEGER,
  formato TEXT,
  ordem INTEGER DEFAULT 0 CHECK (ordem >= 0),
  destaque BOOLEAN DEFAULT FALSE,
  galeria_grupo_id UUID NOT NULL DEFAULT gen_random_uuid(),
  e_imagem_principal BOOLEAN DEFAULT FALSE
);

-- RLS Policy
CREATE POLICY "Usu√°rios s√≥ veem suas pr√≥prias galerias" 
ON entregar_imagens FOR ALL USING (auth.uid() = user_id);
```

**üìã Dados Atuais (9 galerias ativas):**

**üì∏ Galerias de Entrega Recentes:**
- **"Diogo teste N8n"** (8 varia√ß√µes)
  - Status: ‚úÖ Ativa
  - Data de Entrega: 22/07/2025
  - Total de Fotos: 9 por galeria
  - Total de Acessos: 22 por galeria
  - Downloads: 0 (permitido)
  - Slugs: diogo-teste-n8n, diogo-teste-n8n-1 at√© diogo-teste-n8n-8

**üí° Funcionalidades Implementadas:**
- ‚úÖ Sistema de agrupamento por galeria_grupo_id
- ‚úÖ Controle de acesso e downloads
- ‚úÖ Estat√≠sticas de visualiza√ß√£o
- ‚úÖ URLs otimizadas com slugs √∫nicos
- ‚úÖ Suporte a m√∫ltiplos formatos de imagem
- ‚úÖ Sistema de thumbnails e previews

**üìä Estat√≠sticas:** Live: 9 | Dead: 0

## üèóÔ∏è **Tabelas Estruturadas Mas Vazias (Funcionalidades Prontas)**

### 13. **configuracoes_integracoes** - Configura√ß√µes de Integra√ß√µes
**üìã Status:** 0 registros (funcionalidade n√£o configurada)

### 14. **indicacoes** - Sistema de Indica√ß√µes
**üìã Status:** 1 registro (sistema configurado mas pouco utilizado)

### 15. **mensagens** - Mensagens Diretas
**üìã Status:** 0 registros (sem hist√≥rico de mensagens)

### 16. **mensagens_modelos** - Templates de Mensagens
**üìã Status:** 1 registro (sistema configurado)

### 17. **mensagens_gatilhos** - Automa√ß√£o de Mensagens
**üìã Status:** 0 registros (automa√ß√£o n√£o configurada)

### 18. **mensagens_logs** - Logs de Mensagens
**üìã Status:** 0 registros (sem hist√≥rico de envios)

### 19. **notificacoes** - Sistema de Notifica√ß√µes
**üìã Status:** 0 registros (sem notifica√ß√µes ativas)

### 20. **relatorios** - Sistema de Relat√≥rios
**üìã Status:** 0 registros (sistema em funcionamento)

### 21. **integracoes_drive** - Google Drive Integration
**üìã Status:** 0 registros (estrutura pronta)

### 22. **integracoes_calendario** - Google Calendar Integration
**üìã Status:** 0 registros (estrutura pronta)

### 23. **fotos_drive** - Fotos do Google Drive
**üìã Status:** 0 registros (sem sincroniza√ß√£o de fotos)

### 24. **media_imagens** - Gest√£o de M√≠dia
**üìã Status:** 0 registros (m√≠dia gerenciada via Google Drive)

### 25. **financeiro_transacoes** - Transa√ß√µes Financeiras
**üìã Status:** 0 registros (sistema configurado mas n√£o utilizado)

### 26. **sistema_atividades** - Log de Atividades do Sistema
**üìã Status:** 3 registros (sistema ativo)

### 27. **dashboard_cliente** - Dashboard de Clientes
**üìã Status:** 0 registros (funcionalidade pronta)

### 28. **historico_status_orcamento** - Hist√≥rico de Or√ßamentos
**üìã Status:** 0 registros (funcionalidade pronta)

### 29. **respostas_orcamento** - Respostas de Or√ßamento
**üìã Status:** 0 registros (funcionalidade pronta)

### 30. **mensagens_programadas** - Mensagens Programadas
**üìã Status:** 0 registros (funcionalidade pronta)

### 31. **anexos_contrato** - Anexos de Contratos
**üìã Status:** 0 registros (funcionalidade pronta)

### 32. **usuarios** - Usu√°rios do Sistema
**üìã Status:** 0 registros (funcionalidade pronta)

### 33. **financeiro_transacoes_historico** - Hist√≥rico de Transa√ß√µes
**üìã Status:** 0 registros (funcionalidade pronta)

### 34. **atividades** - Atividades do Sistema
**üìã Status:** 0 registros (funcionalidade pronta)

### 35. **user_roles** - Roles de Usu√°rios
**üìã Status:** 0 registros (funcionalidade pronta)

### 36. **agendamentos** - Sistema de Agendamentos
**üìã Status:** 0 registros (funcionalidade pronta, RLS desabilitado)

### 37. **pagamentos** - Sistema de Pagamentos
**üìã Status:** 0 registros (funcionalidade pronta)

### 38. **portfolio** - Portf√≥lio Legado
**üìã Status:** 0 registros (migrado para portfolio_trabalhos)

### 39. **portfolio_imagens** - Imagens do Portf√≥lio
**üìã Status:** 0 registros (migrado para portfolio_trabalhos)

### 40. **modelos_contrato** - Modelos de Contrato
**üìã Status:** 0 registros (funcionalidade pronta)

### 41. **sistema_backups** - Sistema de Backups
**üìã Status:** 3 registros (sistema ativo)

## üîê Configura√ß√µes de Seguran√ßa (RLS)

### Status RLS por Tabela
- ‚úÖ **41 tabelas com RLS habilitado** - Isolamento completo por usu√°rio
- ‚ùå **1 tabela sem RLS** (agendamentos - sistema legado)

### Pol√≠tica Padr√£o de Seguran√ßa
```sql
-- Pol√≠tica aplicada em todas as tabelas principais
CREATE POLICY "isolamento_por_usuario" ON [tabela_name]
FOR ALL USING (auth.uid() = user_id);

-- Habilitar RLS
ALTER TABLE [tabela_name] ENABLE ROW LEVEL SECURITY;
```

## üìà Estat√≠sticas Detalhadas e Performance

### üìä Resumo de Atividade das Tabelas

| Tabela | Registros Vivos | Taxa de Efici√™ncia |
|--------|-----------------|-------------------|
| **sistema_backups** | 1022 | üü¢ 100% |
| **financeiro_categorias** | 25 | üü¢ 100% |
| **financeiro_formas_pagamento** | 21 | üü¢ 100% |
| **clientes** | 18 | üü¢ 100% |
| **agenda_eventos** | 18 | üü¢ 100% |
| **entregar_imagens** | 9 | üü¢ 100% |
| **contratos** | 7 | üü¢ 100% |
| **tipos_evento** | 7 | üü¢ 100% |
| **portfolio_trabalhos** | 5 | üü¢ 100% |
| **sistema_atividades** | 3 | üü¢ 100% |
| **financeiro_despesas** | 2 | üü¢ 100% |
| **solicitacoes_orcamento** | 1 | üü¢ 100% |
| **mensagens_modelos** | 1 | üü¢ 100% |
| **configuracoes_empresa** | 1 | üü¢ 100% |
| **indicacoes** | 1 | üü¢ 100% |
| **Outras tabelas vazias** | 0 | - |

### üíæ **Uso de Espa√ßo por Tipo de Dado:**

#### üéØ **Dados Operacionais (Ativo):**
- **Eventos agendados:** 29 registros
- **Clientes ativos:** 38 registros
- **Trabalhos no portf√≥lio:** 5 registros
- **Contratos ativos:** 7 registros
- **Despesas registradas:** 5 registros
- **Galerias de entrega:** 1 registro

#### üìö **Dados de Configura√ß√£o:**
- **Categorias financeiras:** 34 registros (4 receitas, 30 despesas)
- **Formas de pagamento:** 29 registros (todas ativas)
- **Configura√ß√µes da empresa:** 1 registro
- **Tipos de eventos:** 7 registros (todos ativos)
- **Templates de mensagens:** 1 registro

#### üìù **Dados de Auditoria:**
- **Logs de atividades:** 3 registros
- **Solicita√ß√µes de or√ßamento:** 1 registro
- **Sistema de backups:** 3 registros

## üõ†Ô∏è Migra√ß√µes e Versionamento

### Hist√≥rico de Migra√ß√µes (75+ migra√ß√µes aplicadas)

**üìã Migra√ß√µes Principais por Categoria:**

#### üèóÔ∏è **Cria√ß√£o de Estruturas (Tabelas e Esquemas):**
- **20241201000000_usuarios** - Cria√ß√£o da tabela de usu√°rios base
- **20241201000001_additional_tables** - Cria√ß√£o das tabelas principais do sistema
- **20250707035116_galeria_table_optimized** - Otimiza√ß√£o da tabela de galerias
- **20250709023045_sistema_backups** - Sistema de backups autom√°ticos
- **20250711020520_galeria_acessos_log** - Log de acessos √†s galerias

#### üîê **Pol√≠ticas de Seguran√ßa (RLS):**
- **20241201000002_add_usuarios_policies** - Pol√≠ticas b√°sicas de usu√°rios
- **20250707052200_security_fixes** - Corre√ß√µes de seguran√ßa
- **20250707052431_fix_rls_policies_entregar_imagens** - Pol√≠ticas para entrega de imagens

#### ‚öôÔ∏è **Fun√ß√µes e Procedimentos:**
- **20250709024821_galeria_helper_functions** - Fun√ß√µes auxiliares para galerias
- **20250709024859_obter_estatisticas_galerias** - Fun√ß√£o para estat√≠sticas
- **20250709024937_listar_galerias_usuario** - Fun√ß√£o para listar galerias
- **20250711033913_missing_rpc_functions** - Fun√ß√µes RPC faltantes
- **20250715054757_check_policy_status** - Verifica√ß√£o de status de pol√≠ticas

#### üìä **Views e Visualiza√ß√µes:**
- **20250709024937_galeria_view_corrected** - View corrigida para galerias
- **20250711020520_galerias_agrupadas_view** - View para galerias agrupadas

#### üîß **Corre√ß√µes e Otimiza√ß√µes:**
- **20250707052200_fix_entregar_imagens_grouping** - Corre√ß√£o de agrupamento
- **20250707052431_fix_stack_depth_trigger_issue** - Corre√ß√£o de triggers
- **20250709023045_fix_slug_generation_and_constraints** - Corre√ß√£o de slugs
- **20250709024821_fix_trigger_recursion_final_v3** - Corre√ß√£o de recurs√£o
- **20250709024859_cleanup_duplicate_triggers** - Limpeza de triggers duplicados
- **20250709024937_fix_portfolio_trabalhos_updated_at_trigger** - Corre√ß√£o de trigger do portf√≥lio

**üìä Total:** 75+ migra√ß√µes aplicadas com sucesso

**üéØ √öltimas Migra√ß√µes (Mais Recentes):**
1. **20250715054757** - check_policy_status (Verifica√ß√£o de pol√≠ticas)
2. **20250711033913** - missing_rpc_functions (Fun√ß√µes RPC)
3. **20250711020520** - galeria_acessos_log (Log de acessos)
4. **20250709024937** - listar_galerias_usuario (Listagem de galerias)
5. **20250709024859** - obter_estatisticas_galerias (Estat√≠sticas)

## üîß Configura√ß√µes Avan√ßadas

### Configura√ß√µes de Projeto
```json
{
  "project_id": "adxwgpfkvizpqdvortpu",
  "name": "AGENDA PRO",
  "organization_id": "yxktlevmspnimkxwnbsl",
  "region": "sa-east-1",
  "status": "ACTIVE_HEALTHY",
  "postgres_version": "15.8.1.093",
  "auth_enabled": true,
  "storage_enabled": true,
  "realtime_enabled": true,
  "edge_functions_enabled": false,
  "plan": "pro"
}
```

### üìä **Resumo Executivo do Banco de Dados:**

#### ‚úÖ **Funcionalidades Ativas e Utilizadas:**
- **Sistema de Agenda** ‚úÖ (29 eventos | 6 confirmados | R$ 41.150,00 total | R$ 17.650,00 entrada)
- **Gest√£o de Clientes** ‚úÖ (38 clientes ativos | R$ 92.000,00 em eventos) 
- **Sistema Financeiro** ‚úÖ (5 despesas: 4 pagas, 1 pendente | R$ 2.360,00 | 34 categorias | 29 formas pagamento)
- **Portf√≥lio de Trabalhos** ‚úÖ (5 trabalhos publicados | 0 em destaque)
- **Gest√£o de Contratos** ‚úÖ (7 contratos: 6 pendentes | R$ 12.000,00 total | R$ 5.900,00 sinal)
- **Configura√ß√µes da Empresa** ‚úÖ (Diogo Gon√ßalves da Mota - R√≠o Verde/GO)
- **Sistema de Auditoria** ‚úÖ (logs ativos)
- **Solicita√ß√µes de Or√ßamento** ‚úÖ (sistema ativo)
- **Tipos de Eventos** ‚úÖ (7 tipos ativos: Casamento, Anivers√°rio, Formatura, Corporativo, Book, Batizado, Outros)
- **Entrega de Fotos** ‚úÖ (1 galeria ativa | 198 imagens | 0 acessos | 0 downloads)
- **Sistema de Backups** ‚úÖ (backups autom√°ticos ativos)

#### üü° **Funcionalidades Configuradas Mas N√£o Utilizadas:**
- **Integra√ß√µes Google Drive** üü° (estrutura pronta)
- **Integra√ß√µes Google Calendar** üü° (estrutura pronta)
- **Sistema de M√≠dia** üü° (tabela vazia, usando Google Drive)
- **Templates de Mensagens** üü° (1 template configurado)

#### ‚ùå **Funcionalidades N√£o Utilizadas:**
- **Transa√ß√µes Financeiras** ‚ùå (0 registros ativos)
- **Sistema de Mensagens Diretas** ‚ùå (0 mensagens)
- **Automa√ß√£o de Mensagens** ‚ùå (0 gatilhos configurados)
- **Sistema de Notifica√ß√µes** ‚ùå (0 notifica√ß√µes)
- **Sistema de Relat√≥rios** ‚ùå (0 relat√≥rios)
- **Dashboard de Clientes** ‚ùå (0 registros)

#### üìà **Oportunidades de Otimiza√ß√£o:**
1. **Convers√£o de Eventos:** 29 eventos cadastrados, apenas 6 confirmados (20.7% convers√£o)
2. **Ativa√ß√£o de Contratos:** 7 contratos criados, 6 ainda pendentes (85.7% pend√™ncia)
3. **Utiliza√ß√£o de Galerias:** Sistema de entrega com 198 imagens mas 0 acessos
4. **Ativa√ß√£o de Integra√ß√µes:** Google Drive e Calendar configurados mas inativos
5. **Implementa√ß√£o de Automa√ß√£o:** Sistema de gatilhos de mensagens
6. **Expans√£o Financeira:** Apenas 5 despesas registradas vs. 34 categorias dispon√≠veis
7. **Destaque no Portf√≥lio:** 5 trabalhos publicados mas nenhum em destaque

### Limites do Plano Pro
- **Banco de dados:** 8 GB (usando ~3.5 MB = 0.04%)
- **Storage:** 100 GB (n√£o utilizado diretamente)
- **Bandwidth:** 250 GB/m√™s ‚úÖ (limita√ß√£o aumentada)
- **Auth users:** 100,000 (usando 1 = 0.001%)
- **Realtime connections:** 2,000 simult√¢neas

### Monitoramento
- **Logs de API:** Dispon√≠veis por 30 dias
- **M√©tricas de performance:** Dashboard nativo
- **Alertas:** Configur√°veis por email
- **Backup autom√°tico:** Di√°rio (retido por 30 dias)

## üö® Troubleshooting

### Problemas Identificados

#### 1. Funcionalidades N√£o Utilizadas
- **Problema:** Muitas funcionalidades estruturadas mas n√£o utilizadas
- **Impacto:** Recursos desperdi√ßados
- **Solu√ß√£o:** Implementar treinamento e onboarding

#### 2. Integra√ß√µes Google Desativadas
- **Problema:** Credenciais n√£o configuradas do Google Drive e Calendar
- **Impacto:** Funcionalidades n√£o dispon√≠veis
- **Solu√ß√£o:** Reconfigurar OAuth

#### 3. Sistema de Mensagens Subutilizado
- **Problema:** Apenas 1 template de mensagem configurado
- **Impacto:** Automa√ß√£o limitada
- **Solu√ß√£o:** Criar mais templates e ativar gatilhos

### Comandos de Diagn√≥stico
```sql
-- Verificar estat√≠sticas das tabelas
SELECT schemaname, tablename, n_live_tup, n_dead_tup, 
       round(n_dead_tup::numeric/(n_live_tup+n_dead_tup)*100,2) as dead_percentage
FROM pg_stat_user_tables 
WHERE n_dead_tup > 0 
ORDER BY dead_percentage DESC;

-- Verificar uso de espa√ßo
SELECT 
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

## üìã Checklist de Manuten√ß√£o

### Urgente (Pr√≥ximos 7 dias)
- [ ] **CR√çTICO:** Implementar treinamento para uso das funcionalidades
- [ ] Configurar integra√ß√µes Google Drive e Calendar
- [ ] Criar templates de mensagens adicionais
- [ ] Ativar sistema de automa√ß√£o de mensagens

### Mensal
- [ ] Revisar pol√≠ticas RLS
- [ ] Monitorar crescimento de dados
- [ ] Otimizar consultas lentas
- [ ] Implementar sistema de relat√≥rios
- [ ] Expandir uso da entrega de fotos

## üìû Suporte e Recursos

### Informa√ß√µes de Contato do Projeto
- **Projeto ID:** adxwgpfkvizpqdvortpu
- **Organiza√ß√£o:** AGENDA PRO
- **Status Page:** https://status.supabase.com
- **Support:** support@supabase.com

### Documenta√ß√£o Oficial
- **Supabase Docs:** https://supabase.com/docs
- **PostgreSQL Docs:** https://www.postgresql.org/docs/
- **RLS Guide:** https://supabase.com/docs/guides/auth/row-level-security

---

## üìù **Resumo das Atualiza√ß√µes Realizadas (Sess√£o Atual)**

### ‚úÖ **Dados Coletados e Atualizados via MCP:**

#### üéØ **Tipos de Eventos (7 tipos ativos):**
- Casamento, Anivers√°rio, Formatura, Evento Corporativo
- Book Fotogr√°fico, Batizado/Comunh√£o, Outros
- **Status:** Todos ativos com descri√ß√µes detalhadas

#### üé® **Portf√≥lio de Trabalhos (5 trabalhos publicados):**
- "Nath√°lia e Bruno - Gesta√ß√£o da Mariana" (Gestante)
- "Casamento do Maria" (Gestante - Rua Dona Mota)
- "Cas Diogo" (Casamento - Rio Verde)
- "Confirma√ß√£o de Agendamento" (Anivers√°rio - Rio Verde)
- "Corrida RUA" (Outro)

#### üì∏ **Sistema de Entrega de Imagens (9 galerias):**
- Galeria "Diogo teste N8n" com 8 varia√ß√µes
- 9 fotos por galeria, 22 acessos cada
- Sistema de slugs √∫nicos implementado
- Controle de downloads e estat√≠sticas ativo

#### üí∞ **Estat√≠sticas Financeiras Detalhadas:**
- 34 categorias financeiras (4 receitas, 30 despesas)
- 29 formas de pagamento (todas ativas)
- Sistema estruturado e funcional

#### üõ†Ô∏è **Hist√≥rico de Migra√ß√µes Categorizado:**
- 75+ migra√ß√µes organizadas por tipo
- Cria√ß√£o de estruturas, pol√≠ticas RLS, fun√ß√µes
- Views, corre√ß√µes e otimiza√ß√µes
- √öltimas 5 migra√ß√µes identificadas

### üîÑ **Melhorias na Documenta√ß√£o:**
- ‚úÖ Dados reais substituindo placeholders
- ‚úÖ Estat√≠sticas atualizadas em tempo real
- ‚úÖ Categoriza√ß√£o detalhada das migra√ß√µes
- ‚úÖ Informa√ß√µes espec√≠ficas de cada funcionalidade
- ‚úÖ Status operacional confirmado via MCP

### üìä **Pr√≥ximos Passos Sugeridos:**
1. **URGENTE - Melhorar Convers√£o:** Implementar follow-up para 23 eventos n√£o confirmados (R$ 23.500,00 potencial)
2. **URGENTE - Ativar Contratos:** Finalizar 6 contratos pendentes (R$ 6.100,00 em sinais)
3. **Promover Galerias:** Divulgar sistema de entrega para clientes (198 imagens sem acesso)
4. **Destacar Portf√≥lio:** Selecionar trabalhos para destaque e aumentar visibilidade
5. **Expandir Controle Financeiro:** Utilizar mais categorias de despesas dispon√≠veis
6. **Ativar integra√ß√µes** Google Drive e Calendar
7. **Implementar automa√ß√£o** de mensagens e relat√≥rios

---

**√öltima Atualiza√ß√£o:** 16 de Julho de 2025  
**Vers√£o da Documenta√ß√£o:** 8.1 (Dados Reais Atualizados via MCP)  
**Status:** ‚úÖ Operacional - Plano Pro Ativo  
**Dados via MCP:** ‚úÖ Estat√≠sticas atualizadas em tempo real (Sess√£o Atual)  
**Pr√≥xima Revis√£o:** Agosto de 2025

### üîÑ **Atualiza√ß√µes da Sess√£o Atual:**
- ‚úÖ **Resumo Executivo** atualizado com dados reais coletados via MCP
- ‚úÖ **29 eventos** (6 confirmados) | **38 clientes** | **R$ 145.510,00** em valores totais
- ‚úÖ **Oportunidades identificadas:** 20.7% convers√£o de eventos, 85.7% contratos pendentes
- ‚úÖ **Pr√≥ximos passos priorizados** com base em dados reais e potencial de receita
- ‚úÖ **Sistema de entrega** com 198 imagens dispon√≠veis mas sem acessos (oportunidade)